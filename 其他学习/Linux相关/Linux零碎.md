## 在Linux上输入一个命令，系统会发生什么？

比较完整地考虑，
首先应该要判断你输入的是不是一个路径。如果是一个路径，那么直接执行即可。

如果不是路径，此时说明你输入的应该是一个命令，一般来说要去PATH里面找相应的二进制文件执行。
但是Linux中其实自带一个保存了"命令 - 实际路径"的缓存。

这个缓存可以通过`hash -l`来查看，也可以用其它参数来增删查改。如果某个命令存在于这个缓存中，那么就直接拿缓存中保存了的那个路径来用即可。
如果没有，才会去搜索PATH，找命令的二进制文件。注意找到了之后还要将这个对应关系保存到缓存中。

## Buffer和Cache的区别

在Linux上运行`free -mh`可以看到各种内存分区的占用情况。其中有一个Buffer/Cache，乍一看都叫缓存，但是具体是什么样的呢？

Cache全称Page Cache。他可以说就是一般意义上认为的内存中存在的磁盘缓存。即读写文件时为了避免频繁的磁盘IO，先将要读写的内容加载到Cache中，然后再进行统一的读写，尽量一次IO就搞定。
当下Linux的Cache通常动不动就几个G。Linux的内核设计逻辑就是，尽量使用内存，所以Cache会被用的比较多，只要文件被请求过，那么其内容就会暂时性永久保存在Cache中，即使请求了这个文件的进程本身都已经退出了。
当然，Cache并不是系统运行必须的东西，因此当内存空间吃紧的时候，系统会自动将Cache中的一些内容换回磁盘上去，从而腾出空间来分配给其他进程。

如果说Cache是文件内容的缓存区，那么Buffer就是那些cache中文件的meta信息的缓存区，比如存放路径、权限等。因为其存放的信息不太多，所以Buffer的空间一般都是几十M左右。
在2.4版本的Linux内核以后，Buffer和Cache就被统一起来管理了。

## 软硬链接的区别

Linux中所有文件都由inode和block组成。
inode保存一些meta信息而block保存实际的文件信息。

创建硬链接，是指新建一个indoe指向对应文件的block。因此删除原文件（本质上是删除原文件的inode）并不会影响硬链接对文件的访问。
因为相关block的引用计数也未归零所以系统不会删除block。
硬链接不能跨越文件系统（因为你想不同文件系统的inode和block不一定兼容

另一方面，==软链接本身就是一个独立的文件，只不过其文件内容是一个指向对应文件的绝对路径==。
所以，不要说删除原文件，就算是原文件改个名或者改个路径，软链接就找不到文件了。
因为这是表层的路径映射，软链接可以跨文件系统建立。
Windows中的快捷方式等同于软链接。

## fork函数

在Linux的C程序中，调用fork函数，记住其特点是==“调用一次，返回两次。一次返回给父进程，一次返回给新建出来的子进程”==。
因为子进程的内存是严格复制父进程的，因此父进程运行到fork为止的所有中间变量，子进程也直接继承，并接着运行。

比如下面这段程序：

```c
void main(){
    int i;
    for(i=0;i<3;i++){
        pid_t fpid = fork();
        if(fpid == 0){
            printf('son.');
        }
        else{
            printf('father.');
        }
    }
}
```

上述程序如何运行？第一层进程第一次运行到fork时，i显然是0，于是fork出一个i是0的子进程。此后两进程分别都从`if(fpid == 0)`开始继续运行。下面是这个进程树的图：

```text
           0
    0      1      2
  1   2    2
2
```

每个数字表示一个进程开始运行时其i的值是多少。这个值是`n`的话，就表明这个进程还剩下`3-n`轮循环，即会输出`3-n`行字符串。

所以，上述程序总共会生成`3 + (3+2+1) + (2+1+1) + 1 = 14`行。


## 命令合集

### find

### sar

### uniq与sort
有一个场景题，ip.txt中每一行保存了一个IP的访问记录。
用Linux命令找出其中重复次数最多的三个。

命令是这样的：
```shell script
sort ip.txt | uniq -c | sort -rn | head -n 3
```
第一个sort排序所有IP，将相同的IP都连续摆放在一起。
第二个uniq将连续相同IP进行计数，同时输出计数值（-c参数）
第三个sort针对uniq的输出再次排序，-r表示逆序排序，-n表示以数字排序
最后head就不说了。